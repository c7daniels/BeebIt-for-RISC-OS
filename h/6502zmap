/*>6502zmap.h
 *
 * BeebIt - BBC Micro Model B Emulator
 *
 * Cycle-level CPU emulation
 *
 * (C) Copyright Crispian Daniels, 2025
 *
 * Email: <convertedgames@3insdale.me.uk>
 */

#ifndef __BEEBIT_6502ZMAP_H__
#define __BEEBIT_6502ZMAP_H__

#define R6502_IRQ_ENABLE 0x01
#define R6502_NMI_ENABLE 0x02
#define R6502_IRQ 0x04
#define R6502_NMI 0x08
#define R6502_NMI_IRQ_ENABLE 0x03
#define R6502_NMI_IRQ 0x0C

struct R6502ZONEMAP;
struct R6502CPUMAP;

typedef struct
{
  struct R6502CPUMAP* (*special)(struct R6502CPUMAP* cmap, uintptr_t address_code);
  struct R6502CPUMAP* (*stretch1special)(struct R6502CPUMAP* cmap, uintptr_t address_code);
  struct R6502CPUMAP* (*stretch2special)(struct R6502CPUMAP* cmap, uintptr_t address_code);
  struct R6502CPUMAP* (*mapped)(struct R6502CPUMAP* cmap, uint8_t* p);
} R6502ADDRESSINGCALLBACKS;

typedef struct R6502CPUMAP* (*R6502ADDRESSINGOP)(struct R6502CPUMAP* cmap, uintptr_t address_code, const R6502ADDRESSINGCALLBACKS* callbacks); /*returning the first parameter leaves it in r0 for the next call from AArch32 assembly language*/

typedef struct R6502CPUMAP* (*R6502READSPECIALOP)(struct R6502CPUMAP* cmap, uintptr_t address_code);

typedef struct R6502CPUMAP* (*R6502WRITESPECIALOP)(struct R6502CPUMAP* cmap, uintptr_t address_code, uint8_t value); /*returning the first parameter leaves it in r0 for the next call from AArch32 assembly language*/

typedef struct R6502CPUMAP* (*R6502PERIPHERALOP)(struct R6502CPUMAP* cmap); /*returning the first parameter leaves it in r0 for the next call from AArch32 assembly language*/

/*outline of a storage map for both 6502 CPU and peripheral emulation*/
typedef uintptr_t R6502_AC_ZONE[1];
typedef uintptr_t R6502_AP_ZONE[63];
typedef uintptr_t R6502_BC_ZONE[42];
typedef uintptr_t R6502_BP_ZONE[148];
typedef uintptr_t R6502_CC_ZONE[128];
typedef uintptr_t R6502_CP_ZONE[640];
typedef uintptr_t R6502_DC_ZONE[288];
typedef uintptr_t R6502_DP_ZONE[480];
typedef uintptr_t R6502_EC_ZONE[2304];

/*for aligning a byte with the top of an AArch32 word*/
typedef uint8_t R6502BYTESHIFT[sizeof(uintptr_t)-1];

typedef struct R6502ZONEMAP
{
  // AArch32 offsets &00 - &FF
  R6502_AC_ZONE AC;
  R6502_AP_ZONE AP;

  // AArch32 offsets &100 - &3FF
  uintptr_t interruptqueue;
  R6502BYTESHIFT m_shift; uint8_t m; /*value on data bus*/
  R6502_BC_ZONE BC;
  R6502_BP_ZONE BP;

  // AArch32 offsets &400 - &FFF
  R6502_CC_ZONE CC;
  R6502_CP_ZONE CP;

  // AArch32 offsets &1000 - &1BFF
  R6502_DC_ZONE DC;
  R6502_DP_ZONE DP;

  // AArch32 offsets &1C00 - &3FFF
  R6502_EC_ZONE EC;

} R6502ZONEMAP;

#endif //__BEEBIT_6502ZMAP_H__
